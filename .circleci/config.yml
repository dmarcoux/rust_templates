# https://circleci.com/docs/2.0/
version: 2
jobs:
  build:
    parallelism: 1 # It's not needed to have parallelism right now
    docker:
      # https://hub.docker.com/r/circleci/rust
      - image: circleci/rust:1.39.0-buster
    steps:
      - checkout
      - run:
          name: Check Rust code format
          command: cargo fmt --all -- --check
      - run:
          name: Install clippy and lint Rust code, failing on warnings from default linters and cargo manifest linters
          command: rustup component add clippy && cargo clippy -- --deny warnings --deny clippy::cargo
      - run:
          name: Run tests (while enforcing Cargo.lock to be up to date)
          command: cargo test --locked
