# https://circleci.com/docs/2.0/
version: 2
jobs:
  build:
    parallelism: 1 # It's not needed to have parallelism right now
    docker:
      # https://hub.docker.com/r/circleci/rust
      - image: circleci/rust:1.39.0-buster
    steps:
      - checkout
      - run:
          name: Check if Cargo.lock is up to date
          command: cargo test --locked
      - run:
          name: Install rustfmt and check Rust code format
          command: rustup component add rustfmt && cargo fmt --all -- --check
      - run:
          name: Install clippy and lint Rust code # default settings + warnings for cargo
          command: rustup component add clippy && cargo clippy -- -W clippy::cargo
      - run:
          name: Compile Rust code
          command: cargo build
      - run:
          name: Run tests
          command: cargo test
